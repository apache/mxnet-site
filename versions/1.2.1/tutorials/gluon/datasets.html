<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Gluon <code class=" docutils="" literal"="" property="og:title"/><span class="pre">Dataset</span></head></html>s and <code class="docutils literal"><span class="pre">DataLoader</span></code>" />
    <meta content="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/image/og-logo.png" property="og:image">
<meta content="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/image/og-logo.png" property="og:image:secure_url">
<meta content="Gluon <code class=" docutils="" literal"="" property="og:description"/><span class="pre">Dataset</span></meta></meta>s and <code class="docutils literal"><span class="pre">DataLoader</span></code>" />
    <title>Gluon Datasets and DataLoader — mxnet  documentation</title>
<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" rel="stylesheet"/>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet"/>
<link href="../../_static/basic.css" rel="stylesheet" type="text/css">
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../_static/mxnet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="https://code.jquery.com/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/searchtools_custom.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<script src="../../_static/selectlang.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<script type="text/javascript"> jQuery(function() { Search.loadIndex("/versions/1.2.1/searchindex.js"); Search.init();}); </script>
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
      Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-96378503-1', 'auto');
      ga('send', 'pageview');

    </script>
<!-- -->
<!-- <script type="text/javascript" src="../../_static/jquery.js"></script> -->
<!-- -->
<!-- <script type="text/javascript" src="../../_static/underscore.js"></script> -->
<!-- -->
<!-- <script type="text/javascript" src="../../_static/doctools.js"></script> -->
<!-- -->
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<!-- -->
<link href="../../genindex.html" rel="index" title="Index">
<link href="../../search.html" rel="search" title="Search"/>
<link href="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/image/mxnet-icon.png" rel="icon" type="image/png"/>
</link></link></link>
<body background="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/image/mxnet-background-compressed.jpeg" role="document">
<div class="content-block"><div class="navbar navbar-fixed-top">
<div class="container" id="navContainer">
<div class="innder" id="header-inner">
<h1 id="logo-wrap">
<a href="../../" id="logo"><img src="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/image/mxnet_logo.png"/></a>
</h1>
<nav class="nav-bar" id="main-nav">
<a class="main-nav-link" href="/versions/1.2.1/install/index.html">Install</a>
<span id="dropdown-menu-position-anchor">
<a aria-expanded="true" aria-haspopup="true" class="main-nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button">Gluon <span class="caret"></span></a>
<ul class="dropdown-menu navbar-menu" id="package-dropdown-menu">
<li><a class="main-nav-link" href="/versions/1.2.1/tutorials/gluon/gluon.html">About</a></li>
<li><a class="main-nav-link" href="https://www.d2l.ai/">Dive into Deep Learning</a></li>
<li><a class="main-nav-link" href="https://gluon-cv.mxnet.io">GluonCV Toolkit</a></li>
<li><a class="main-nav-link" href="https://gluon-nlp.mxnet.io/">GluonNLP Toolkit</a></li>
</ul>
</span>
<span id="dropdown-menu-position-anchor">
<a aria-expanded="true" aria-haspopup="true" class="main-nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button">API <span class="caret"></span></a>
<ul class="dropdown-menu navbar-menu" id="package-dropdown-menu">
<li><a class="main-nav-link" href="/versions/1.2.1/api/python/index.html">Python</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/c++/index.html">C++</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/julia/index.html">Julia</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/perl/index.html">Perl</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/r/index.html">R</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/scala/index.html">Scala</a></li>
</ul>
</span>
<span id="dropdown-menu-position-anchor-docs">
<a aria-expanded="true" aria-haspopup="true" class="main-nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button">Docs <span class="caret"></span></a>
<ul class="dropdown-menu navbar-menu" id="package-dropdown-menu-docs">
<li><a class="main-nav-link" href="/versions/1.2.1/faq/index.html">FAQ</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/tutorials/index.html">Tutorials</a>
<li><a class="main-nav-link" href="https://github.com/apache/incubator-mxnet/tree/1.2.1/example">Examples</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/architecture/index.html">Architecture</a></li>
<li><a class="main-nav-link" href="https://cwiki.apache.org/confluence/display/MXNET/Apache+MXNet+Home">Developer Wiki</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/model_zoo/index.html">Model Zoo</a></li>
<li><a class="main-nav-link" href="https://github.com/onnx/onnx-mxnet">ONNX</a></li>
</li></ul>
</span>
<span id="dropdown-menu-position-anchor-community">
<a aria-expanded="true" aria-haspopup="true" class="main-nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button">Community <span class="caret"></span></a>
<ul class="dropdown-menu navbar-menu" id="package-dropdown-menu-community">
<li><a class="main-nav-link" href="http://discuss.mxnet.io">Forum</a></li>
<li><a class="main-nav-link" href="https://github.com/apache/incubator-mxnet/tree/1.2.1">Github</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/community/contribute.html">Contribute</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/community/powered_by.html">Powered By</a></li>
</ul>
</span>
<span id="dropdown-menu-position-anchor-version" style="position: relative"><a href="#" class="main-nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">1.2.1<span class="caret"></span></a><ul id="package-dropdown-menu" class="dropdown-menu"><li><a href="/">master</a></li><li><a href="/versions/1.7.0/">1.7.0</a></li><li><a href=/versions/1.6.0/>1.6.0</a></li><li><a href=/versions/1.5.0/>1.5.0</a></li><li><a href=/versions/1.4.1/>1.4.1</a></li><li><a href=/versions/1.3.1/>1.3.1</a></li><li><a href=/versions/1.2.1/>1.2.1</a></li><li><a href=/versions/1.1.0/>1.1.0</a></li><li><a href=/versions/1.0.0/>1.0.0</a></li><li><a href=/versions/0.12.1/>0.12.1</a></li><li><a href=/versions/0.11.0/>0.11.0</a></li></ul></span></nav>
<script> function getRootPath(){ return "../../" } </script>
<div class="burgerIcon dropdown">
<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">☰</a>
<ul class="dropdown-menu" id="burgerMenu">
<li><a href="/versions/1.2.1/install/index.html">Install</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/tutorials/index.html">Tutorials</a></li>
<li class="dropdown-submenu dropdown">
<a aria-expanded="true" aria-haspopup="true" class="dropdown-toggle burger-link" data-toggle="dropdown" href="#" tabindex="-1">Gluon</a>
<ul class="dropdown-menu navbar-menu" id="package-dropdown-menu">
<li><a class="main-nav-link" href="/versions/1.2.1/tutorials/gluon/gluon.html">About</a></li>
<li><a class="main-nav-link" href="http://gluon.mxnet.io">The Straight Dope (Tutorials)</a></li>
<li><a class="main-nav-link" href="https://gluon-cv.mxnet.io">GluonCV Toolkit</a></li>
<li><a class="main-nav-link" href="https://gluon-nlp.mxnet.io/">GluonNLP Toolkit</a></li>
</ul>
</li>
<li class="dropdown-submenu">
<a aria-expanded="true" aria-haspopup="true" class="dropdown-toggle burger-link" data-toggle="dropdown" href="#" tabindex="-1">API</a>
<ul class="dropdown-menu">
<li><a class="main-nav-link" href="/versions/1.2.1/api/python/index.html">Python</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/c++/index.html">C++</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/julia/index.html">Julia</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/perl/index.html">Perl</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/r/index.html">R</a></li>
<li><a class="main-nav-link" href="/versions/1.2.1/api/scala/index.html">Scala</a></li>
</ul>
</li>
<li class="dropdown-submenu">
<a aria-expanded="true" aria-haspopup="true" class="dropdown-toggle burger-link" data-toggle="dropdown" href="#" tabindex="-1">Docs</a>
<ul class="dropdown-menu">
<li><a href="/versions/1.2.1/faq/index.html" tabindex="-1">FAQ</a></li>
<li><a href="/versions/1.2.1/tutorials/index.html" tabindex="-1">Tutorials</a></li>
<li><a href="https://github.com/apache/incubator-mxnet/tree/1.2.1/example" tabindex="-1">Examples</a></li>
<li><a href="/versions/1.2.1/architecture/index.html" tabindex="-1">Architecture</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/MXNET/Apache+MXNet+Home" tabindex="-1">Developer Wiki</a></li>
<li><a href="/versions/1.2.1/model_zoo/index.html" tabindex="-1">Gluon Model Zoo</a></li>
<li><a href="https://github.com/onnx/onnx-mxnet" tabindex="-1">ONNX</a></li>
</ul>
</li>
<li class="dropdown-submenu dropdown">
<a aria-haspopup="true" class="dropdown-toggle burger-link" data-toggle="dropdown" href="#" role="button" tabindex="-1">Community</a>
<ul class="dropdown-menu">
<li><a href="http://discuss.mxnet.io" tabindex="-1">Forum</a></li>
<li><a href="https://github.com/apache/incubator-mxnet/tree/1.2.1" tabindex="-1">Github</a></li>
<li><a href="/versions/1.2.1/community/contribute.html" tabindex="-1">Contribute</a></li>
<li><a href="/versions/1.2.1/community/powered_by.html" tabindex="-1">Powered By</a></li>
</ul>
</li>
<li id="dropdown-menu-position-anchor-version-mobile" class="dropdown-submenu" style="position: relative"><a href="#" tabindex="-1">1.2.1</a><ul class="dropdown-menu"><li><a tabindex="-1" href=/>master</a></li><li><a tabindex="-1" href=/versions/1.6.0/>1.6.0</a></li><li><a tabindex="-1" href=/versions/1.5.0/>1.5.0</a></li><li><a tabindex="-1" href=/versions/1.4.1/>1.4.1</a></li><li><a tabindex="-1" href=/versions/1.3.1/>1.3.1</a></li><li><a tabindex="-1" href=/versions/1.2.1/>1.2.1</a></li><li><a tabindex="-1" href=/versions/1.1.0/>1.1.0</a></li><li><a tabindex="-1" href=/versions/1.0.0/>1.0.0</a></li><li><a tabindex="-1" href=/versions/0.12.1/>0.12.1</a></li><li><a tabindex="-1" href=/versions/0.11.0/>0.11.0</a></li></ul></li></ul>
</div>
<div class="plusIcon dropdown">
<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button"><span aria-hidden="true" class="glyphicon glyphicon-plus"></span></a>
<ul class="dropdown-menu dropdown-menu-right" id="plusMenu"></ul>
</div>
<div id="search-input-wrap">
<form action="../../search.html" autocomplete="off" class="" method="get" role="search">
<div class="form-group inner-addon left-addon">
<i class="glyphicon glyphicon-search"></i>
<input class="form-control" name="q" placeholder="Search" type="text"/>
</div>
<input name="check_keywords" type="hidden" value="yes">
<input name="area" type="hidden" value="default"/>
</input></form>
<div id="search-preview"></div>
</div>
<div id="searchIcon">
<span aria-hidden="true" class="glyphicon glyphicon-search"></span>
</div>
<!-- <div id="lang-select-wrap"> -->
<!--   <label id="lang-select-label"> -->
<!--     <\!-- <i class="fa fa-globe"></i> -\-> -->
<!--     <span></span> -->
<!--   </label> -->
<!--   <select id="lang-select"> -->
<!--     <option value="en">Eng</option> -->
<!--     <option value="zh">中文</option> -->
<!--   </select> -->
<!-- </div> -->
<!--     <a id="mobile-nav-toggle">
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
      </a> -->
</div>
</div>
</div>
<script type="text/javascript">
        $('body').css('background', 'white');
    </script>
<div class="container">
<div class="row">
<div aria-label="main navigation" class="sphinxsidebar leftsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/python/index.html">Python Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/r/index.html">R Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/julia/index.html">Julia Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/c++/index.html">C++ Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/scala/index.html">Scala Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/perl/index.html">Perl Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">HowTo Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/index.html">System Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community</a></li>
</ul>
</div>
</div>
<div class="content">
<div class="page-tracker"></div>
<div class="section" id="gluon-datasets-and-dataloader">
<span id="gluon-datasets-and-dataloader"></span><h1>Gluon <code class="docutils literal"><span class="pre">Dataset</span></code>s and <code class="docutils literal"><span class="pre">DataLoader</span></code><a class="headerlink" href="#gluon-datasets-and-dataloader" title="Permalink to this headline">¶</a></h1>
<p>One of the most critical steps for model training and inference is loading the data: without data you can’t do Machine Learning! In this tutorial we use the Gluon API to define a <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> and use a <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> to iterate through the dataset in mini-batches.</p>
<div class="section" id="introduction-to-datasets">
<span id="introduction-to-datasets"></span><h2>Introduction to <code class="docutils literal"><span class="pre">Dataset</span></code>s<a class="headerlink" href="#introduction-to-datasets" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> objects are used to represent collections of data, and include methods to load and parse the data (that is often stored on disk). Gluon has a number of different <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> classes for working with image data straight out-of-the-box, but we’ll use the <a class="reference external" href="/api/python/gluon/data.html?highlight=arraydataset#mxnet.gluon.data.ArrayDataset"><code class="docutils literal"><span class="pre">ArrayDataset</span></code></a> to introduce the idea of a <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>.</p>
<p>We first start by generating random data <code class="docutils literal"><span class="pre">X</span></code> (with 3 variables) and corresponding random labels <code class="docutils literal"><span class="pre">y</span></code> to simulate a typical supervised learning task. We generate 10 samples and we pass them all to the <a class="reference external" href="/api/python/gluon/data.html?highlight=arraydataset#mxnet.gluon.data.ArrayDataset"><code class="docutils literal"><span class="pre">ArrayDataset</span></code></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mxnet</span> <span class="kn">as</span> <span class="nn">mx</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">ArrayDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>A key feature of a <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> is the <strong><em>ability to retrieve a single sample given an index</em></strong>. Our random data and labels were generated in memory, so this <a class="reference external" href="/api/python/gluon/data.html?highlight=arraydataset#mxnet.gluon.data.ArrayDataset"><code class="docutils literal"><span class="pre">ArrayDataset</span></code></a> doesn’t have to load anything from disk, but the interface is the same for all <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>s.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="k">assert</span> <span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">)</span>
<span class="k">assert</span> <span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span>
 <span class="p">[</span> <span class="mf">0.4375872</span>   <span class="mf">0.29753461</span>  <span class="mf">0.89177299</span><span class="p">]</span>
 <span class="o"><</span><span class="n">NDArray</span> <span class="mi">3</span> <span class="nd">@cpu</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">></span><span class="p">,</span>
 <span class="p">[</span> <span class="mf">0.83261985</span><span class="p">]</span>
 <span class="o"><</span><span class="n">NDArray</span> <span class="mi">1</span> <span class="nd">@cpu</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">></span><span class="p">)</span>
</pre></div>
</div>
<p>We get a tuple of a data sample and its corresponding label, which makes sense because we passed the data <code class="docutils literal"><span class="pre">X</span></code> and the labels <code class="docutils literal"><span class="pre">y</span></code> in that order when we instantiated the <a class="reference external" href="/api/python/gluon/data.html?highlight=arraydataset#mxnet.gluon.data.ArrayDataset"><code class="docutils literal"><span class="pre">ArrayDataset</span></code></a>. We don’t usually retrieve individual samples from <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> objects though (unless we’re quality checking the output samples). Instead we use a <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a>.</p>
</div>
<div class="section" id="introduction-to-dataloader">
<span id="introduction-to-dataloader"></span><h2>Introduction to <code class="docutils literal"><span class="pre">DataLoader</span></code><a class="headerlink" href="#introduction-to-dataloader" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> is used to create mini-batches of samples from a <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>, and provides a convenient iterator interface for looping these batches. It’s typically much more efficient to pass a mini-batch of data through a neural network than a single sample at a time, because the computation can be performed in parallel. A required parameter of <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> is the size of the mini-batches you want to create, called <code class="docutils literal"><span class="pre">batch_size</span></code>.</p>
<p>Another benefit of using <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> is the ability to easily load data in parallel using <a class="reference external" href="https://docs.python.org/3.6/library/multiprocessing.html"><code class="docutils literal"><span class="pre">multiprocessing</span></code></a>. Just set the <code class="docutils literal"><span class="pre">num_workers</span></code> parameter to the number of CPUs avaliable on your machine for maximum performance.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">cpu_count</span>

<span class="n">data_loader</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">cpu_count</span><span class="p">())</span>

<span class="k">for</span> <span class="n">X_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="ow">in</span> <span class="n">data_loader</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"X_batch has shape {}, and y_batch has shape {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">X_batch</span> <span class="n">has</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="ow">and</span> <span class="n">y_batch</span> <span class="n">has</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_batch</span> <span class="n">has</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="ow">and</span> <span class="n">y_batch</span> <span class="n">has</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>We can see 2 mini-batches of data (and labels), each with 5 samples, which makes sense given we started with a dataset of 10 samples. When comparing the shape of the batches to the samples returned by the <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>, we’ve gained an extra dimension at the start which is sometimes called the batch axis.</p>
<p>Our <code class="docutils literal"><span class="pre">data_loader</span></code> loop will stop when every sample of <code class="docutils literal"><span class="pre">dataset</span></code> has been returned as part of a batch. Sometimes the dataset length isn’t divisible by the mini-batch size, leaving a final batch with a smaller number of samples. <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a>‘s default behavior is to return this smaller mini-batch, but this can be changed by setting the <code class="docutils literal"><span class="pre">last_batch</span></code> parameter to <code class="docutils literal"><span class="pre">discard</span></code> (which ignores the last batch) or <code class="docutils literal"><span class="pre">rollover</span></code> (which starts the next epoch with the remaining samples).</p>
</div>
<div class="section" id="machine-learning-with-datasets-and-dataloaders">
<span id="machine-learning-with-datasets-and-dataloaders"></span><h2>Machine learning with <code class="docutils literal"><span class="pre">Dataset</span></code>s and <code class="docutils literal"><span class="pre">DataLoader</span></code>s<a class="headerlink" href="#machine-learning-with-datasets-and-dataloaders" title="Permalink to this headline">¶</a></h2>
<p>You will often use a few different <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> objects in your Machine Learning project. It’s essential to separate your training dataset from testing dataset, and it’s also good practice to have validation dataset (a.k.a. development dataset) that can be used for optimising hyperparameters.</p>
<p>Using Gluon <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> objects, we define the data to be included in each of these separate datasets. Common use cases for loading data are covered already (e.g. <a class="reference external" href="/api/python/gluon/data.html?highlight=imagefolderdataset#mxnet.gluon.data.vision.datasets.ImageFolderDataset"><code class="docutils literal"><span class="pre">mxnet.gluon.data.vision.datasets.ImageFolderDataset</span></code></a>), but it’s simple to create your own custom <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> classes for other types of data. You can even use included <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> objects for common datasets if you want to experiment quickly; they download and parse the data for you! In this example we use the <a class="reference external" href="https://github.com/zalandoresearch/fashion-mnist">Fashion MNIST</a> dataset from Zalando Research.</p>
<p>Many of the image <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>s accept a function (via the optional <code class="docutils literal"><span class="pre">transform</span></code> parameter) which is applied to each sample returned by the <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>. It’s useful for performing data augmentation, but can also be used for more simple data type conversion and pixel value scaling as seen below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'float32'</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span>

<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">FashionMNIST</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">FashionMNIST</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">matplotlib.pylab</span> <span class="kn">import</span> <span class="n">imshow</span>

<span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">234</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">label_desc</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">'T-shirt/top'</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">'Trouser'</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">'Pullover'</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">'Dress'</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">'Coat'</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="s1">'Sandal'</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="s1">'Shirt'</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span><span class="s1">'Sneaker'</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="s1">'Bag'</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="s1">'Ankle boot'</span><span class="p">}</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Data type: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Label: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Label description: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label_desc</span><span class="p">[</span><span class="n">label</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>Data type: <class 'numpy.float32'>
Label: 8
Label description: Bag
</pre></div>
</div>
<p><img alt="png" src="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/doc/tutorials/gluon/datasets/fashion_mnist_bag.png"/></p>
<p>When training machine learning models it is important to shuffle the training samples every time you pass through the dataset (i.e. each epoch). Sometimes the order of your samples will have a spurious relationship with the target variable, and shuffling the samples helps remove this. With <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> it’s as simple as adding <code class="docutils literal"><span class="pre">shuffle=True</span></code>. You don’t need to shuffle the validation and testing data though.</p>
<p>If you have more complex shuffling requirements (e.g. when handling sequential data), take a look at <a class="reference external" href="/api/python/gluon/data.html?highlight=batchsampler#mxnet.gluon.data.BatchSampler"><code class="docutils literal"><span class="pre">mxnet.gluon.data.BatchSampler</span></code></a> and pass this to your <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> instead.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">train_data_loader</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">cpu_count</span><span class="p">())</span>
<span class="n">valid_data_loader</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">cpu_count</span><span class="p">())</span>
</pre></div>
</div>
<p>With both <code class="docutils literal"><span class="pre">DataLoader</span></code>s defined, we can now train a model to classify each image and evaluate the validation loss at each epoch. Our Fashion MNIST dataset has 10 classes including shirt, dress, sneakers, etc. We define a simple fully connected network with a softmax output and use cross entropy as our loss.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mxnet</span> <span class="kn">import</span> <span class="n">gluon</span><span class="p">,</span> <span class="n">autograd</span><span class="p">,</span> <span class="n">ndarray</span>

<span class="k">def</span> <span class="nf">construct_net</span><span class="p">():</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">gluon</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">HybridSequential</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">net</span><span class="o">.</span><span class="n">name_scope</span><span class="p">():</span>
        <span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gluon</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">"relu"</span><span class="p">))</span>
        <span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gluon</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">"relu"</span><span class="p">))</span>
        <span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gluon</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">net</span>

<span class="c1"># construct and initialize network.</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">construct_net</span><span class="p">()</span>
<span class="n">net</span><span class="o">.</span><span class="n">hybridize</span><span class="p">()</span>
<span class="n">net</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">mx</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">Xavier</span><span class="p">())</span>
<span class="c1"># define loss and trainer.</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">gluon</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyLoss</span><span class="p">()</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">gluon</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">collect_params</span><span class="p">(),</span> <span class="s1">'sgd'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'learning_rate'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>

<span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>

    <span class="c1"># training loop (with autograd and trainer steps, etc.)</span>
    <span class="n">cumulative_train_loss</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">training_samples</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_data_loader</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">as_in_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">784</span><span class="p">))</span> <span class="c1"># 28*28=784</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">as_in_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">autograd</span><span class="o">.</span><span class="n">record</span><span class="p">():</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">trainer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cumulative_train_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">training_samples</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">train_loss</span> <span class="o">=</span> <span class="n">cumulative_train_loss</span><span class="o">.</span><span class="n">asscalar</span><span class="p">()</span><span class="o">/</span><span class="n">training_samples</span>

    <span class="c1"># validation loop</span>
    <span class="n">cumulative_valid_loss</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">valid_samples</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">valid_data_loader</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">as_in_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">784</span><span class="p">))</span> <span class="c1"># 28*28=784</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">as_in_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">cumulative_valid_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">valid_samples</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">valid_loss</span> <span class="o">=</span> <span class="n">cumulative_valid_loss</span><span class="o">.</span><span class="n">asscalar</span><span class="p">()</span><span class="o">/</span><span class="n">valid_samples</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">"Epoch {}, training loss: {:.2f}, validation loss: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">,</span> <span class="n">valid_loss</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Epoch</span> <span class="mi">0</span><span class="p">,</span> <span class="n">training</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.54</span><span class="p">,</span> <span class="n">validation</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.45</span>
<span class="n">Epoch</span> <span class="mi">1</span><span class="p">,</span> <span class="n">training</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">validation</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.39</span>
<span class="n">Epoch</span> <span class="mi">2</span><span class="p">,</span> <span class="n">training</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.36</span><span class="p">,</span> <span class="n">validation</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.39</span>
<span class="n">Epoch</span> <span class="mi">3</span><span class="p">,</span> <span class="n">training</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span> <span class="n">validation</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.34</span>
<span class="n">Epoch</span> <span class="mi">4</span><span class="p">,</span> <span class="n">training</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.32</span><span class="p">,</span> <span class="n">validation</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.33</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-own-data-with-included-datasets">
<span id="using-own-data-with-included-datasets"></span><h1>Using own data with included <code class="docutils literal"><span class="pre">Dataset</span></code>s<a class="headerlink" href="#using-own-data-with-included-datasets" title="Permalink to this headline">¶</a></h1>
<p>Gluon has a number of different <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a> classes for working with your own image data straight out-of-the-box. You can get started quickly using the <a class="reference external" href="/api/python/gluon/data.html?highlight=imagefolderdataset#mxnet.gluon.data.vision.datasets.ImageFolderDataset"><code class="docutils literal"><span class="pre">mxnet.gluon.data.vision.datasets.ImageFolderDataset</span></code></a> which loads images directly from a user-defined folder, and infers the label (i.e. class) from the folders.</p>
<p>We will run through an example for image classification, but a similar process applies for other vision tasks. If you already have your own collection of images to work with you should partition your data into training and test sets, and place all objects of the same class into seperate folders. Similar to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">car</span><span class="o">/</span><span class="n">abc</span><span class="o">.</span><span class="n">jpg</span>
<span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">car</span><span class="o">/</span><span class="n">efg</span><span class="o">.</span><span class="n">jpg</span>
<span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">hij</span><span class="o">.</span><span class="n">jpg</span>
<span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">klm</span><span class="o">.</span><span class="n">jpg</span>
<span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">car</span><span class="o">/</span><span class="n">xyz</span><span class="o">.</span><span class="n">jpg</span>
<span class="o">./</span><span class="n">images</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">uvw</span><span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
<p>You can download the Caltech 101 dataset if you don’t already have images to work with for this example, but please note the download is 126MB.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>!wget http://www.vision.caltech.edu/Image_Datasets/Caltech101/101_ObjectCategories.tar.gz
!tar -xzf 101_ObjectCategories.tar.gz
</pre></div>
</div>
<p>After downloading and extracting the data archive, we seperate the data into training and test sets (50:50 split), and place images of the same class into the same folders, as required for using <a class="reference external" href="/api/python/gluon/data.html?highlight=imagefolderdataset#mxnet.gluon.data.vision.datasets.ImageFolderDataset"><code class="docutils literal"><span class="pre">ImageFolderDataset</span></code></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">split_train_test</span><span class="p">(</span><span class="n">source_dir</span><span class="o">=</span><span class="s1">'./101_ObjectCategories'</span><span class="p">,</span> <span class="n">train_dir</span><span class="o">=</span><span class="s1">'./images/train'</span><span class="p">,</span> <span class="n">test_dir</span><span class="o">=</span><span class="s1">'./images/test'</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Walks through source_dir and alternates between places files in the train_dir and the test_dir.</span>
<span class="sd">    """</span>
    <span class="n">train_set</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">source_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">current_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">dataset_dir</span> <span class="o">=</span> <span class="n">train_dir</span> <span class="k">if</span> <span class="n">train_set</span> <span class="k">else</span> <span class="n">test_dir</span>
            <span class="n">new_filepath</span> <span class="o">=</span> <span class="n">current_filepath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">dataset_dir</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">new_filepath</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">FileExistsError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">current_filepath</span><span class="p">,</span> <span class="n">new_filepath</span><span class="p">)</span>
            <span class="n">train_set</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">train_set</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span>

<span class="n">split_train_test</span><span class="p">()</span>
</pre></div>
</div>
<p>We instantiate the <a class="reference external" href="/api/python/gluon/data.html?highlight=imagefolderdataset#mxnet.gluon.data.vision.datasets.ImageFolderDataset"><code class="docutils literal"><span class="pre">ImageFolderDataset</span></code></a>s by providing the path to the data, and the folder structure will be traversed to determine which image classes are available and which images correspond to each class. You must take care to ensure the same classes are both the training and testing datasets, otherwise the label encodings can get muddled.</p>
<p>Optionally, you can pass a <code class="docutils literal"><span class="pre">transform</span></code> parameter to these <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>s as we’ve seen before.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">ImageFolderDataset</span><span class="p">(</span><span class="s1">'./images/train'</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">gluon</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">ImageFolderDataset</span><span class="p">(</span><span class="s1">'./images/test'</span><span class="p">)</span>
</pre></div>
</div>
<p>Samples from these datasets are tuples of data and label. Images are loaded from disk, decoded and optionally transformed when the <code class="docutils literal"><span class="pre">__getitem__(i)</span></code> method is called (equivalent to <code class="docutils literal"><span class="pre">train_dataset[i]</span></code>).</p>
<p>As with the Fashion MNIST dataset the labels will be integer encoded. You can use the <code class="docutils literal"><span class="pre">synsets</span></code> property of the <a class="reference external" href="/api/python/gluon/data.html?highlight=imagefolderdataset#mxnet.gluon.data.vision.datasets.ImageFolderDataset"><code class="docutils literal"><span class="pre">ImageFolderDataset</span></code></a>s to retrieve the original descriptions (e.g. <code class="docutils literal"><span class="pre">train_dataset.synsets[i]</span></code>).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">888</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Data type: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Label: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Label description: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">synsets</span><span class="p">[</span><span class="n">label</span><span class="p">]))</span>
<span class="k">assert</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>Data type: <class 'numpy.uint8'>
Label: 2
Label description: Faces_easy
</pre></div>
</div>
<p><img alt="png" src="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/doc/tutorials/gluon/datasets/caltech101_face.png"/></p>
</div>
<div class="section" id="using-own-data-with-custom-datasets">
<span id="using-own-data-with-custom-datasets"></span><h1>Using own data with custom <code class="docutils literal"><span class="pre">Dataset</span></code>s<a class="headerlink" href="#using-own-data-with-custom-datasets" title="Permalink to this headline">¶</a></h1>
<p>Sometimes you have data that doesn’t quite fit the format expected by the included <a class="reference external" href="/api/python/gluon/data.html?highlight=dataset#mxnet.gluon.data.Dataset"><code class="docutils literal"><span class="pre">Dataset</span></code></a>s. You might be able to preprocess your data to fit the expected format, but it is easy to create your own dataset to do this.</p>
<p>All you need to do is create a class that implements a <code class="docutils literal"><span class="pre">__getitem__</span></code> method, that returns a sample (i.e. a tuple of <a class="reference external" href="/api/python/ndarray/ndarray.html#mxnet.ndarray.NDArray"><code class="docutils literal"><span class="pre">mx.nd.NDArray</span></code></a>s).</p>
<p>See the <a class="reference external" href="/versions/1.2.1/tutorials/python/data_augmentation_with_masks.html">Data Augmentation with Masks</a> tutorial for an example of this.</p>
</div>
<div class="section" id="appendix-upgrading-from-module-dataiter-to-gluon-dataloader">
<span id="appendix-upgrading-from-module-dataiter-to-gluon-dataloader"></span><h1>Appendix: Upgrading from Module <code class="docutils literal"><span class="pre">DataIter</span></code> to Gluon <code class="docutils literal"><span class="pre">DataLoader</span></code><a class="headerlink" href="#appendix-upgrading-from-module-dataiter-to-gluon-dataloader" title="Permalink to this headline">¶</a></h1>
<p>Before Gluon’s <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a>, MXNet used <a class="reference external" href="/api/python/io/io.html?highlight=dataiter#mxnet.io.DataIter"><code class="docutils literal"><span class="pre">DataIter</span></code></a> objects for loading data for training and testing. <a class="reference external" href="/api/python/io/io.html?highlight=dataiter#mxnet.io.DataIter"><code class="docutils literal"><span class="pre">DataIter</span></code></a> has a similar interface for iterating through data, but it isn’t directly compatible with typical Gluon <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> loops. Unlike Gluon <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a> which often returns a tuple of <code class="docutils literal"><span class="pre">(data,</span> <span class="pre">label)</span></code>, a <a class="reference external" href="/api/python/io/io.html?highlight=dataiter#mxnet.io.DataIter"><code class="docutils literal"><span class="pre">DataIter</span></code></a> returns a <a class="reference external" href="/api/python/io/io.html?highlight=databatch#mxnet.io.DataBatch"><code class="docutils literal"><span class="pre">DataBatch</span></code></a> object that has <code class="docutils literal"><span class="pre">data</span></code> and <code class="docutils literal"><span class="pre">label</span></code> properties. Switching to <a class="reference external" href="/api/python/gluon/data.html?highlight=dataloader#mxnet.gluon.data.DataLoader"><code class="docutils literal"><span class="pre">DataLoader</span></code></a>s is highly recommended when using Gluon, but you’ll need to take care of pre-processing steps such as augmentations in a <code class="docutils literal"><span class="pre">transform</span></code> function.</p>
<p>So you can get up and running with Gluon quicker if you have already imlemented complex pre-processing steps using <a class="reference external" href="/api/python/io/io.html?highlight=dataiter#mxnet.io.DataIter"><code class="docutils literal"><span class="pre">DataIter</span></code></a>, we have provided a simple class to wrap existing <a class="reference external" href="/api/python/io/io.html?highlight=dataiter#mxnet.io.DataIter"><code class="docutils literal"><span class="pre">DataIter</span></code></a> objects so they can be used in a typical Gluon training loop. You can use this class for <code class="docutils literal"><span class="pre">DataIter</span></code>s such as <a class="reference external" href="/api/python/image/image.html?highlight=imageiter#mxnet.image.ImageIter"><code class="docutils literal"><span class="pre">mxnet.image.ImageIter</span></code></a> and <a class="reference external" href="/api/python/io/io.html?highlight=imagere#mxnet.io.ImageRecordIter"><code class="docutils literal"><span class="pre">mxnet.io.ImageRecordIter</span></code></a> that have single data and label arrays.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataIterLoader</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_iter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_iter</span> <span class="o">=</span> <span class="n">data_iter</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_iter</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_iter</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span> <span class="c1"># for Python 2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">data_iter</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">NDArrayIter</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">data_iter_loader</span> <span class="o">=</span> <span class="n">DataIterLoader</span><span class="p">(</span><span class="n">data_iter</span><span class="p">)</span>
<span class="k">for</span> <span class="n">X_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="ow">in</span> <span class="n">data_iter_loader</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">X_batch</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">y_batch</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar rightsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li><a class="reference internal" href="#">Gluon <code class="docutils literal"><span class="pre">Dataset</span></code>s and <code class="docutils literal"><span class="pre">DataLoader</span></code></a><ul>
<li><a class="reference internal" href="#introduction-to-datasets">Introduction to <code class="docutils literal"><span class="pre">Dataset</span></code>s</a></li>
<li><a class="reference internal" href="#introduction-to-dataloader">Introduction to <code class="docutils literal"><span class="pre">DataLoader</span></code></a></li>
<li><a class="reference internal" href="#machine-learning-with-datasets-and-dataloaders">Machine learning with <code class="docutils literal"><span class="pre">Dataset</span></code>s and <code class="docutils literal"><span class="pre">DataLoader</span></code>s</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-own-data-with-included-datasets">Using own data with included <code class="docutils literal"><span class="pre">Dataset</span></code>s</a></li>
<li><a class="reference internal" href="#using-own-data-with-custom-datasets">Using own data with custom <code class="docutils literal"><span class="pre">Dataset</span></code>s</a></li>
<li><a class="reference internal" href="#appendix-upgrading-from-module-dataiter-to-gluon-dataloader">Appendix: Upgrading from Module <code class="docutils literal"><span class="pre">DataIter</span></code> to Gluon <code class="docutils literal"><span class="pre">DataLoader</span></code></a></li>
</ul>
</div>
</div>
</div><div class="footer">
<div class="section-disclaimer">
<div class="container">
<div>
<img height="60" src="https://raw.githubusercontent.com/dmlc/web-data/master/mxnet/image/apache_incubator_logo.png"/>
<p>
            Apache MXNet is an effort undergoing incubation at The Apache Software Foundation (ASF), <strong>sponsored by the <i>Apache Incubator</i></strong>. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
        </p>
<p>
            "Copyright © 2017-2018, The Apache Software Foundation
            Apache MXNet, MXNet, Apache, the Apache feather, and the Apache MXNet project logo are either registered trademarks or trademarks of the Apache Software Foundation."
        </p>
</div>
</div>
</div>
</div> <!-- pagename != index -->
</div>
<script crossorigin="anonymous" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="../../_static/js/sidebar.js" type="text/javascript"></script>
<script src="../../_static/js/search.js" type="text/javascript"></script>
<script src="../../_static/js/navbar.js" type="text/javascript"></script>
<script src="../../_static/js/clipboard.min.js" type="text/javascript"></script>
<script src="../../_static/js/copycode.js" type="text/javascript"></script>
<script src="../../_static/js/page.js" type="text/javascript"></script>
<script src="../../_static/js/docversion.js" type="text/javascript"></script>
<script type="text/javascript">
        $('body').ready(function () {
            $('body').css('visibility', 'visible');
        });
    </script>
</body>
