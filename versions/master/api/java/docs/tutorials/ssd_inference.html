<!DOCTYPE html>

<!---
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->

<html lang=" en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/versions/master/assets/img/mxnet-icon.png" rel="icon" type="image/png"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SSD Inference | Apache MXNet</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="SSD Inference" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A flexible and efficient library for deep learning." />
<meta property="og:description" content="A flexible and efficient library for deep learning." />
<link rel="canonical" href="https://mxnet.apache.org/versions/master/api/java/docs/tutorials/ssd_inference" />
<meta property="og:url" content="https://mxnet.apache.org/versions/master/api/java/docs/tutorials/ssd_inference" />
<meta property="og:site_name" content="Apache MXNet" />
<script type="application/ld+json">
{"url":"https://mxnet.apache.org/versions/master/api/java/docs/tutorials/ssd_inference","headline":"SSD Inference","description":"A flexible and efficient library for deep learning.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/versions/master/assets/docsearch.min.css" /><link rel="stylesheet" href="/versions/master/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://mxnet.apache.org/versions/master/feed.xml" title="Apache MXNet" /><!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  /* We explicitly disable cookie tracking to avoid privacy issues */
  _paq.push(['disableCookies']);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://analytics.apache.org/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '23']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

<script src="/versions/master/assets/js/jquery-3.3.1.min.js"></script>
    <script src="/versions/master/assets/js/docsearch.min.js"></script><script src="/versions/master/assets/js/globalSearch.js" defer></script>
  <script src="/versions/master/assets/js/clipboard.js" defer></script>
  <script src="/versions/master/assets/js/copycode.js" defer></script></head>
<body><header class="site-header" role="banner">

  <script>
    $(document).ready(function () {

      // HEADER OPACITY LOGIC

      function opacity_header() {
        var value = "rgba(4,140,204," + ($(window).scrollTop() / 300 + 0.4) + ")"
        $('.site-header').css("background-color", value)
      }

      $(window).scroll(function () {
        opacity_header()
      })
      opacity_header();

      // MENU SELECTOR LOGIC
      $('.page-link').each( function () {
        if (window.location.href.includes(this.href)) {
          $(this).addClass("page-current");
        }
      });
    })
  </script>
  <div class="wrapper">
    <a class="site-title" rel="author" href="/versions/master/"><img
            src="/versions/master/assets/img/mxnet_logo.png" class="site-header-logo"></a>
    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger"/>
      <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
      </label>
      <div class="gs-search-border">
        <div id="gs-search-icon"></div>
        <form id="global-search-form">
          <input id="global-search" type="text" title="Search" placeholder="Search" />
          <div id="global-search-dropdown-container">
            <button class="gs-current-version btn" type="button" data-toggle="dropdown">
                <span id="gs-current-version-label">master</span>
                <svg class="gs-dropdown-caret" viewBox="0 0 32 32" class="icon icon-caret-bottom" aria-hidden="true">
                    <path class="dropdown-caret-path" d="M24 11.305l-7.997 11.39L8 11.305z"></path>
                </svg>
            </button>
            <ul class="gs-opt-group gs-version-dropdown">
              
                
                  <li class="gs-opt gs-versions active">master</li>
                
              
                
                  <li class="gs-opt gs-versions">1.9.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.8.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.7.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.6.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.5.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.4.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.3.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.2.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.1.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.0.0</li>
                
              
                
                  <li class="gs-opt gs-versions">0.12.1</li>
                
              
                
                  <li class="gs-opt gs-versions">0.11.0</li>
                
              
            </ul>
        </div>
          <span id="global-search-close">x</span>
        </form>
      </div>
      <div class="trigger">
        <div id="global-search-mobile-border">
          <div id="gs-search-icon-mobile"></div>
          <input id="global-search-mobile" placeholder="Search..." type="text"/>
          <div id="global-search-dropdown-container-mobile">
            <button class="gs-current-version-mobile btn" type="button" data-toggle="dropdown">
                <svg class="gs-dropdown-caret" viewBox="0 0 32 32" class="icon icon-caret-bottom" aria-hidden="true">
                    <path class="dropdown-caret-path" d="M24 11.305l-7.997 11.39L8 11.305z"></path>
                </svg>
            </button>
            <ul class="gs-opt-group gs-version-dropdown-mobile">
              
                
                  <li class="gs-opt gs-versions active">master</li>
                
              
                
                  <li class="gs-opt gs-versions">1.9.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.8.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.7.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.6.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.5.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.4.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.3.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.2.1</li>
                
              
                
                  <li class="gs-opt gs-versions">1.1.0</li>
                
              
                
                  <li class="gs-opt gs-versions">1.0.0</li>
                
              
                
                  <li class="gs-opt gs-versions">0.12.1</li>
                
              
                
                  <li class="gs-opt gs-versions">0.11.0</li>
                
              
            </ul>
        </div>
        </div>
        <a class="page-link" href="/versions/master/get_started">Get Started</a>
        <a class="page-link" href="/versions/master/features">Features</a>
        <a class="page-link" href="/versions/master/ecosystem">Ecosystem</a>
        <a class="page-link" href="/versions/master/api">Docs & Tutorials</a>
        <a class="page-link" href="/versions/master/trusted_by">Trusted By</a>
        <a class="page-link" href="https://github.com/apache/incubator-mxnet">GitHub</a>
        <div class="dropdown" style="min-width:100px">
          <span class="dropdown-header">Apache
            <svg class="dropdown-caret" viewBox="0 0 32 32" class="icon icon-caret-bottom" aria-hidden="true"><path class="dropdown-caret-path" d="M24 11.305l-7.997 11.39L8 11.305z"></path></svg>
          </span>
          <div class="dropdown-content" style="min-width:250px">
            <a href="https://www.apache.org/foundation/">Apache Software Foundation</a>
            <a href="https://incubator.apache.org/">Apache Incubator</a>
            <a href="https://www.apache.org/licenses/">License</a>
            <a href="/versions/master/api/faq/security.html">Security</a>
            <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy</a>
            <a href="https://www.apache.org/events/current-event">Events</a>
            <a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a href="https://www.apache.org/foundation/thanks.html">Thanks</a>
          </div>
        </div>
        <div class="dropdown">
          <span class="dropdown-header">master
            <svg class="dropdown-caret" viewBox="0 0 32 32" class="icon icon-caret-bottom" aria-hidden="true"><path class="dropdown-caret-path" d="M24 11.305l-7.997 11.39L8 11.305z"></path></svg>
          </span>
          <div class="dropdown-content">
            
              
                <a class="dropdown-option-active" href="/">master</a>
              
            
              
                <a href="/versions/1.9.1/">1.9.1</a>
              
            
              
                <a href="/versions/1.8.0/">1.8.0</a>
              
            
              
                <a href="/versions/1.7.0/">1.7.0</a>
              
            
              
                <a href="/versions/1.6.0/">1.6.0</a>
              
            
              
                <a href="/versions/1.5.0/">1.5.0</a>
              
            
              
                <a href="/versions/1.4.1/">1.4.1</a>
              
            
              
                <a href="/versions/1.3.1/">1.3.1</a>
              
            
              
                <a href="/versions/1.2.1/">1.2.1</a>
              
            
              
                <a href="/versions/1.1.0/">1.1.0</a>
              
            
              
                <a href="/versions/1.0.0/">1.0.0</a>
              
            
              
                <a href="/versions/0.12.1/">0.12.1</a>
              
            
              
                <a href="/versions/0.11.0/">0.11.0</a>
              
            
          </div>
        </div>
      </div>
    </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
    <script>

</script>
<article class="post">

    <header class="post-header wrapper">
        <h1 class="post-title">SSD Inference</h1>
        <h3></h3></header>

    <div class="post-content">
        <div class="wrapper">
            <div class="row">
    <div class="col-3 docs-side-bar">

        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
        
        
        
        
        
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
        
           <!-- resource-p -->
          <!-- page -->
        </ul>
    </div>
    <div class="col-9">
        <!--- Licensed to the Apache Software Foundation (ASF) under one -->
<!--- or more contributor license agreements.  See the NOTICE file -->
<!--- distributed with this work for additional information -->
<!--- regarding copyright ownership.  The ASF licenses this file -->
<!--- to you under the Apache License, Version 2.0 (the -->
<!--- "License"); you may not use this file except in compliance -->
<!--- with the License.  You may obtain a copy of the License at -->

<!---   http://www.apache.org/licenses/LICENSE-2.0 -->

<!--- Unless required by applicable law or agreed to in writing, -->
<!--- software distributed under the License is distributed on an -->
<!--- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY -->
<!--- KIND, either express or implied.  See the License for the -->
<!--- specific language governing permissions and limitations -->
<!--- under the License. -->

<h1 id="multi-object-detection-using-pre-trained-ssd-model-via-java-inference-apis">Multi Object Detection using pre-trained SSD Model via Java Inference APIs</h1>

<p>This tutorial shows how to use MXNet Java Inference APIs to run inference on a pre-trained Single Shot Detector (SSD) Model.</p>

<p>The SSD model is trained on the Pascal VOC 2012 dataset. The network is a SSD model built on Resnet50 as the base network to extract image features. The model is trained to detect the following entities (classes): [‘aeroplane’, ‘bicycle’, ‘bird’, ‘boat’, ‘bottle’, ‘bus’, ‘car’, ‘cat’, ‘chair’, ‘cow’, ‘diningtable’, ‘dog’, ‘horse’, ‘motorbike’, ‘person’, ‘pottedplant’, ‘sheep’, ‘sofa’, ‘train’, ‘tvmonitor’]. For more details about the model, you can refer to the <a href="https://github.com/apache/incubator-mxnet/tree/master/example/ssd">MXNet SSD example</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To complete this tutorial, you need the following:</p>
<ul>
  <li><a href="mxnet_java_on_intellij">MXNet Java Setup on IntelliJ IDEA</a> (Optional)</li>
  <li><a href="https://www.gnu.org/software/wget/">wget</a> To download model artifacts</li>
  <li>SSD Model artifacts
    <ul>
      <li>Use the following script to get the SSD Model files :
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data_path</span><span class="o">=</span>/tmp/resnet50_ssd
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$data_path</span><span class="s2">"</span>
wget https://s3.amazonaws.com/model-server/models/resnet50_ssd/resnet50_ssd_model-symbol.json <span class="nt">-P</span> <span class="nv">$data_path</span>
wget https://s3.amazonaws.com/model-server/models/resnet50_ssd/resnet50_ssd_model-0000.params <span class="nt">-P</span> <span class="nv">$data_path</span>
wget https://s3.amazonaws.com/model-server/models/resnet50_ssd/synset.txt <span class="nt">-P</span> <span class="nv">$data_path</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Test images  : A few sample images to run inference on.
    <ul>
      <li>Use the following script to download sample images :
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">image_path</span><span class="o">=</span>/tmp/resnet50_ssd/images
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$image_path</span><span class="s2">"</span>
<span class="nb">cd</span> <span class="nv">$image_path</span>
wget https://cloud.githubusercontent.com/assets/3307514/20012567/cbb60336-a27d-11e6-93ff-cbc3f09f5c9e.jpg <span class="nt">-O</span> dog.jpg
wget https://cloud.githubusercontent.com/assets/3307514/20012563/cbb41382-a27d-11e6-92a9-18dab4fd1ad3.jpg <span class="nt">-O</span> person.jpg
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p>Alternately, you can get the entire SSD Model artifacts + images in one single script from the MXNet Repository by running <a href="https://github.com/apache/incubator-mxnet/blob/master/scala-package/examples/scripts/infer/objectdetector/get_ssd_data.sh">get_ssd_data.sh script</a></p>

<h2 id="time-to-code">Time to code!</h2>
<p>1. Following the <a href="mxnet_java_on_intellij">MXNet Java Setup on IntelliJ IDEA</a> tutorial, in the same project <code class="highlighter-rouge">JavaMXNet</code>, create a new empty class called : <code class="highlighter-rouge">ObjectDetectionTutorial.java</code>.</p>

<p>2. In the <code class="highlighter-rouge">main</code> function of <code class="highlighter-rouge">ObjectDetectionTutorial.java</code> define the downloaded model path and the image data paths. This is the same path where we downloaded the model artifacts and images in a previous step.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">modelPathPrefix</span> <span class="o">=</span> <span class="s">"/tmp/resnet50_ssd/resnet50_ssd_model"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">inputImagePath</span> <span class="o">=</span> <span class="s">"/tmp/resnet50_ssd/images/dog.jpg"</span><span class="o">;</span>
</code></pre></div></div>

<p>3. We can run the inference code in this example on either CPU or GPU (if you have a GPU backed machine) by choosing the appropriate context.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span> <span class="n">context</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">();</span>
<span class="o">...</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span> <span class="nf">getContext</span><span class="o">()</span> <span class="o">{</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">cpu</span><span class="o">());</span> <span class="c1">// Choosing CPU Context here</span>

<span class="k">return</span> <span class="n">ctx</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>4. To provide an input to the model, define the input shape to the model and the Input Data Descriptor (DataDesc) as shown below :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Shape</span> <span class="n">inputShape</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Shape</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">512</span><span class="o">,</span> <span class="mi">512</span><span class="o">});</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">DataDesc</span><span class="o">&gt;</span> <span class="n">inputDescriptors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">DataDesc</span><span class="o">&gt;();</span>
<span class="n">inputDescriptors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">DataDesc</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">inputShape</span><span class="o">,</span> <span class="nc">DType</span><span class="o">.</span><span class="na">Float32</span><span class="o">(),</span> <span class="s">"NCHW"</span><span class="o">));</span>
</code></pre></div></div>

<p>The input shape can be interpreted as follows : The input has a batch size of 1, with 3 RGB channels in the image, and the height and width of the image is 512 each.</p>

<p>5. To run an actual inference on the given image, add the following lines to the <code class="highlighter-rouge">ObjectDetectionTutorial.java</code> class :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="nc">ObjectDetector</span><span class="o">.</span><span class="na">loadImageFromFile</span><span class="o">(</span><span class="n">inputImagePath</span><span class="o">);</span>
<span class="nc">ObjectDetector</span> <span class="n">objDet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectDetector</span><span class="o">(</span><span class="n">modelPathPrefix</span><span class="o">,</span> <span class="n">inputDescriptors</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">ObjectDetectorOutput</span><span class="o">&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">objDet</span><span class="o">.</span><span class="na">imageObjectDetect</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span> <span class="c1">// Top 3 objects detected will be returned</span>
</code></pre></div></div>

<p>6. Let’s piece all of the above steps together by showing the final contents of the <code class="highlighter-rouge">ObjectDetectionTutorial.java</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">mxnet</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.mxnet.infer.javaapi.ObjectDetector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.mxnet.infer.javaapi.ObjectDetectorOutput</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.mxnet.javaapi.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.mxnet.javaapi.DType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.mxnet.javaapi.DataDesc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.mxnet.javaapi.Shape</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ObjectDetectionTutorial</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">String</span> <span class="n">modelPathPrefix</span> <span class="o">=</span> <span class="s">"/tmp/resnet50_ssd/resnet50_ssd_model"</span><span class="o">;</span>

        <span class="nc">String</span> <span class="n">inputImagePath</span> <span class="o">=</span> <span class="s">"/tmp/resnet50_ssd/images/dog.jpg"</span><span class="o">;</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span> <span class="n">context</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">();</span>

        <span class="nc">Shape</span> <span class="n">inputShape</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Shape</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">512</span><span class="o">,</span> <span class="mi">512</span><span class="o">});</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">DataDesc</span><span class="o">&gt;</span> <span class="n">inputDescriptors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">DataDesc</span><span class="o">&gt;();</span>
        <span class="n">inputDescriptors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">DataDesc</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">inputShape</span><span class="o">,</span> <span class="nc">DType</span><span class="o">.</span><span class="na">Float32</span><span class="o">(),</span> <span class="s">"NCHW"</span><span class="o">));</span>

        <span class="nc">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="nc">ObjectDetector</span><span class="o">.</span><span class="na">loadImageFromFile</span><span class="o">(</span><span class="n">inputImagePath</span><span class="o">);</span>
        <span class="nc">ObjectDetector</span> <span class="n">objDet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectDetector</span><span class="o">(</span><span class="n">modelPathPrefix</span><span class="o">,</span> <span class="n">inputDescriptors</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">ObjectDetectorOutput</span><span class="o">&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">objDet</span><span class="o">.</span><span class="na">imageObjectDetect</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>

        <span class="n">printOutput</span><span class="o">(</span><span class="n">output</span><span class="o">,</span> <span class="n">inputShape</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span> <span class="nf">getContext</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">cpu</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">ctx</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printOutput</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">ObjectDetectorOutput</span><span class="o">&gt;&gt;</span> <span class="n">output</span><span class="o">,</span> <span class="nc">Shape</span> <span class="n">inputShape</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">StringBuilder</span> <span class="n">outputStr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>

        <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">inputShape</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">inputShape</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">ObjectDetectorOutput</span><span class="o">&gt;</span> <span class="n">ele</span> <span class="o">:</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">ObjectDetectorOutput</span> <span class="n">i</span> <span class="o">:</span> <span class="n">ele</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">outputStr</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"Class: "</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="na">getClassName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
                <span class="n">outputStr</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"Probabilties: "</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="na">getProbability</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>

                <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Float</span><span class="o">&gt;</span> <span class="n">coord</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="na">getXMin</span><span class="o">()</span> <span class="o">*</span> <span class="n">width</span><span class="o">,</span>
                        <span class="n">i</span><span class="o">.</span><span class="na">getXMax</span><span class="o">()</span> <span class="o">*</span> <span class="n">height</span><span class="o">,</span> <span class="n">i</span><span class="o">.</span><span class="na">getYMin</span><span class="o">()</span> <span class="o">*</span> <span class="n">width</span><span class="o">,</span> <span class="n">i</span><span class="o">.</span><span class="na">getYMax</span><span class="o">()</span> <span class="o">*</span> <span class="n">height</span><span class="o">);</span>
                <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">float</span> <span class="nl">c:</span> <span class="n">coord</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">", "</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">outputStr</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"Coord:"</span> <span class="o">+</span> <span class="n">sb</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">2</span><span class="o">)+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">outputStr</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>7. To compile and run this code, change directories to this project’s root folder, then run the following:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean <span class="nb">install </span>dependency:copy-dependencies
</code></pre></div></div>

<p>The build generates a new jar file in the <code class="highlighter-rouge">target</code> folder called <code class="highlighter-rouge">javaMXNet-1.0-SNAPSHOT.jar</code>.</p>

<p>To run the ObjectDetectionTutorial.java use the following command from the project’s root folder.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-cp</span> <span class="s2">"target/javaMXNet-1.0-SNAPSHOT.jar:target/dependency/*"</span> mxnet.ObjectDetectionTutorial
</code></pre></div></div>

<p>You should see a similar output being generated for the dog image that we used:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Class: car
Probabilties: 0.99847263
Coord:312.21335, 72.02908, 456.01443, 150.66176
Class: bicycle
Probabilties: 0.9047381
Coord:155.9581, 149.96365, 383.83694, 418.94516
Class: dog
Probabilties: 0.82268167
Coord:83.82356, 179.14001, 206.63783, 476.78754
</code></pre></div></div>

<p><img src="https://cloud.githubusercontent.com/assets/3307514/20012567/cbb60336-a27d-11e6-93ff-cbc3f09f5c9e.jpg" alt="dog_1" /></p>

<p>The results returned by the inference call translate into the regions in the image where the model detected objects.</p>

<p><img src="https://cloud.githubusercontent.com/assets/3307514/19171063/91ec2792-8be0-11e6-983c-773bd6868fa8.png" alt="dog_2" /></p>

<h2 id="next-steps">Next Steps</h2>
<p>For more information about MXNet Java resources, see the following:</p>

<ul>
  <li><a href="/versions/master/api/java">Java Inference API</a></li>
  <li><a href="https://github.com/apache/incubator-mxnet/tree/master/scala-package/examples/src/main/java/org/apache/mxnetexamples/javaapi/infer">Java Inference Examples</a></li>
  <li><a href="/versions/master/api">MXNet Tutorials Index</a></li>
</ul>
</div>
</div>

        </div>
    </div>

</article>

</main><footer class="site-footer h-card">
    <div class="wrapper">
        <div class="row">
            <div class="col-4">
                <h4 class="footer-category-title">Resources</h4>
                <ul class="contact-list">
                    <li><a href="/versions/master/community#stay-connected">Mailing lists</a></li>
                    <li><a href="/versions/master/community#github-issues">Github Issues</a></li>
                    <li><a href="https://github.com/apache/incubator-mxnet/projects">Projects</a></li>
                    <li><a href="https://cwiki.apache.org/confluence/display/MXNET/Apache+MXNet+Home">Developer Wiki</a></li>
                    <li><a href="https://discuss.mxnet.io">Forum</a></li>
                    <li><a href="/versions/master/community">Contribute To MXNet</a></li>
                </ul>
            </div>

            <div class="col-4"><ul class="social-media-list"><li><a href="https://github.com/apache/incubator-mxnet"><svg class="svg-icon"><use xlink:href="/versions/master/assets/minima-social-icons.svg#github"></use></svg> <span class="username">apache/incubator-mxnet</span></a></li><li><a href="https://www.twitter.com/apachemxnet"><svg class="svg-icon"><use xlink:href="/versions/master/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">apachemxnet</span></a></li><li><a href="https://youtube.com/apachemxnet"><svg class="svg-icon"><use xlink:href="/versions/master/assets/minima-social-icons.svg#youtube"></use></svg> <span class="username">apachemxnet</span></a></li></ul>
</div>

            <div class="col-4 footer-text">
                <p>A flexible and efficient library for deep learning.</p>
            </div>
        </div>
    </div>
</footer>
<footer class="site-footer2">
    <div class="wrapper">
        <div class="row">
            <div class="col-3">
                <img src="/versions/master/assets/img/apache_incubator_logo.png" class="footer-logo col-2">
            </div>
            <div class="footer-bottom-warning col-9">
                <p>Apache MXNet is an effort undergoing incubation at <a href="http://www.apache.org/">The Apache Software Foundation</a> (ASF), <span
                        style="font-weight:bold">sponsored by the <i>Apache Incubator</i></span>. Incubation is required
                    of all newly accepted projects until a further review indicates that the infrastructure,
                    communications, and decision making process have stabilized in a manner consistent with other
                    successful ASF projects. While incubation status is not necessarily a reflection of the completeness
                    or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
                </p><p>"Copyright © 2017-2022, The Apache Software Foundation Apache MXNet, MXNet, Apache, the Apache
                    feather, and the Apache MXNet project logo are either registered trademarks or trademarks of the
                    Apache Software Foundation."</p>
            </div>
        </div>
    </div>
</footer>




</body>

</html>
